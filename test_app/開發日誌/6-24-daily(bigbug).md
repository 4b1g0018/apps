# 專題開發日誌 - 2025/06/25

## 今日進度總結

今天我們完成了兩個非常重要的里程碑，讓這個 App 從一個「有趣的玩具」正式進化成一個「有用的工具」。首先，我們實作了**訓練紀錄的永久儲存**，現在所有的努力都會被好好地記下來。接著，我們根據企劃書的願景，成功地打造了一個**視覺化的「訓練日曆」**，讓使用者可以一目了然地看到自己的訓練足跡。

最重要的是，我們今天還一起經歷了一場精彩的「除錯大作戰」，並從中學到了寶貴的實戰經驗！

---

## 我們今天到底做了什麼？

想像一下，我們的 App 是一家餐廳。

1.  **幫菜單升級**：我們做的第一件事，就是幫「訓練紀錄」這張訂單，加上了一個新的欄位：「**訓練部位**」。這樣廚房（資料庫）才知道這份訂單不只是「槓鈴臥推」，而是「**胸部**的槓鈴臥推」。

2.  **訓練服務生傳菜**：接著，我們訓練了餐廳裡所有的服務生（每一個頁面），讓他們在傳遞訂單的時候，要記得把「訓練部位」這個重要的資訊，像接力棒一樣，一站一站地從頭傳到尾。

3.  **把餐廳的白板牆換成高級電子日曆**：我們覺得原本那個單純的文字列表太無聊了，所以我們去外面買了一個超酷的「電子日曆」(`table_calendar` 套件) 裝在牆上。

4.  **偵錯大作戰**：沒想到，這個新日曆一裝上去，餐廳就直接當機停擺！客人（我們）點「訓練紀錄」，整個餐廳就靜止不動。
    * 我們一開始以為是舊訂單（沒有部位的舊紀錄）格式不對，把餐廳打掃乾淨、丟掉舊訂單再開，結果還是一樣。
    * 後來我們又懷疑是不是服務生傳菜的路線有問題，改了路線，結果還是一樣。
    * 最後，我們使出絕招，把餐廳裡所有東西都搬走，只留下那面「電子日曆」。結果，日曆牆上終於跳出了錯誤訊息：「**我看不懂中文啦！** (Locale data has not been initialized)」。
    * **破案了！** 原來是我們忘了在餐廳開門前（App 啟動時），先給日曆一本「中英字典」(`initializeDateFormatting`)，所以它一看到中文的「星期日、星期一」，就直接罷工了。

5.  **重新開張**：我們在餐廳門口放好字典後，再把所有東西搬回去，餐廳就完美地運作了！現在牆上的日曆不但能顯示，還會在有訓練的日子，標上不同顏色的漂亮圓點。

---

## 專業的技術總結

### 1. 資料庫結構遷移 (Database Migration)

為了儲存訓練部位，我們對 SQLite 資料庫進行了結構升級。

* **模型修改**：在 `workout_log_model.dart` 中為 `WorkoutLog` 類別新增了 `bodyPart` 屬性，並同步更新了 `toMap` 和 `fromMap` 方法，使其能夠正確地序列化和反序列化 `BodyPart` 枚舉。
* **資料表升級**：在 `database_helper.dart` 中，我們將資料庫 `version` 從 2 提升至 3。這觸發了 `onUpgrade` 回呼函式，我們在其中使用 `ALTER TABLE` 這個 SQL 指令，為現有的 `workout_logs` 資料表安全地新增了 `bodyPart` 欄位，而不會刪除使用者原有的資料。這是處理已上線 App 資料庫更新的標準做法。

### 2. UI 層與資料層的互動

* **參數傳遞 (Prop Drilling)**：我們實踐了從父元件到子元件的參數逐層傳遞。將 `bodyPart` 從 `select_exercise_page` 一路傳遞至 `training_session_page`，最終在儲存時寫入 `WorkoutLog` 物件，確保了資料的完整性。
* **非同步 UI 處理 (`FutureBuilder`)**：在新的 `workout_history_page` 中，我們使用 `FutureBuilder` 來優雅地處理非同步的資料庫讀取操作。它可以根據 `Future` 的不同狀態（`waiting`, `hasError`, `hasData`）來顯示不同的 UI（如進度條、錯誤訊息、或最終的日曆畫面），大幅提升了使用者體驗。

### 3. 第三方套件整合與除錯

* **套件整合**：我們成功地將 `table_calendar` 和 `intl` 這兩個套件整合進專案。
* **根本原因分析 (Root Cause Analysis)**：透過系統性的「問題隔離法」，我們最終定位到 App 卡死的根本原因，是 `table_calendar` 在顯示本地化日期（如 `zh_TW`）前，需要一個全域的初始化步驟。
* **解決方案**：在 `main.dart` 的 `main` 函式中，於 `runApp()` 之前呼叫 `initializeDateFormatting()`，預先載入 Flutter 所需的本地化日期符號資料，從而解決了 `LocaleDataException` 錯誤。

---

## 更新後的專案結構

我們今天為 App 的兩個核心部分新增了檔案，並大幅改造了歷史紀錄頁面。


lib/
├── main.dart             # (有修改) App 總入口，新增了日期本地化初始化。
|
├── models/               # 【藍圖/規格表】資料夾
│   ├── exercise_model.dart     # (舊)
│   └── workout_log_model.dart  # (有修改) 新增 bodyPart 屬性與對應的轉換邏輯。
|
├── pages/                # 【展示廳】資料夾 (所有 UI 頁面)
│   ├── ... (舊頁面)
│   ├── exercise_setup_page.dart  # (有修改) 需傳遞 bodyPart 參數。
│   ├── training_session_page.dart # (有修改) 需接收 bodyPart 並在儲存時使用。
│   └── workout_history_page.dart # (大改造) 重建成功能完整的訓練日曆頁面。
|
└── services/             # 【後勤部門/工具箱】資料夾
└── database_helper.dart      # (有修改) 升級資料庫版本，修改資料表結構。


---

## 下一步規劃

App 的核心功能已經非常完整了！接下來我們可以考慮：
1.  繼續完善次要功能，例如「個人資料修改」。
2.  開始挑戰最核心、也最有趣的「藍牙硬體連線」功能。

